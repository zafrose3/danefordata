<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Analysis Studio - danefordata</title>
    <meta name="description" content="Interactive data analysis studio with conversational AI. Upload your data and get insights through natural language conversations." />
    <link rel="stylesheet" href="../css/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Fdatachatp8321back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background text-text-primary overflow-hidden">
    <!-- Navigation Header -->
    <nav class="bg-surface shadow-sm border-b border-border-light sticky top-0 z-50">
        <div class="max-w-full mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="homepage.html" class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-primary-600 to-secondary-500 rounded-lg flex items-center justify-center">
                            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                            </svg>
                        </div>
                        <span class="text-xl font-bold text-text-primary">danefordata</span>
                    </a>
                </div>

                <!-- Desktop Navigation -->
                <div class="hidden md:flex items-center space-x-8">
                    <a href="homepage.html" class="text-text-secondary hover:text-primary-600 transition-colors">Home</a>
                    <a href="analysis_studio.html" class="text-primary-600 font-medium">Studio</a>
                    <a href="template_gallery.html" class="text-text-secondary hover:text-primary-600 transition-colors">Templates</a>
                    <a href="about.html" class="text-text-secondary hover:text-primary-600 transition-colors">About</a>
                    <button class="btn-primary">Share Analysis</button>
                </div>

                <!-- Mobile Menu Button -->
                <div class="md:hidden">
                    <button class="text-text-secondary hover:text-primary-600" onclick="toggleMobileMenu()">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Mobile Menu -->
            <div id="mobileMenu" class="hidden md:hidden py-4 border-t border-border-light">
                <div class="flex flex-col space-y-4">
                    <a href="homepage.html" class="text-text-secondary">Home</a>
                    <a href="analysis_studio.html" class="text-primary-600 font-medium">Studio</a>
                    <a href="template_gallery.html" class="text-text-secondary">Templates</a>
                    <a href="about.html" class="text-text-secondary">About</a>
                    <button class="btn-primary w-full">Share Analysis</button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Application Layout -->
    <div class="flex h-screen bg-background" style="height: calc(100vh - 4rem);">
        <!-- Left Sidebar - File Management -->
        <div class="w-80 bg-surface border-r border-border-light flex flex-col" id="leftSidebar">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-border-light">
                <h2 class="text-lg font-semibold mb-4">File Manager</h2>
                
                <!-- Quick Actions Toolbar -->
                <div class="grid grid-cols-2 gap-2 mb-4">
                    <button class="btn-primary text-sm py-2" onclick="startNewAnalysis()">
                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                        New Analysis
                    </button>
                    <button class="bg-secondary text-white px-4 py-2 rounded-lg font-semibold hover:bg-secondary-600 transition-colors text-sm" onclick="exportResults()">
                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        Export
                    </button>
                </div>
            </div>

            <!-- File Upload Zone -->
            <div class="p-6 border-b border-border-light">
                <div class="border-2 border-dashed border-border rounded-lg p-6 text-center hover:border-primary-300 transition-colors cursor-pointer" onclick="document.getElementById('fileInput').click()" ondrop="handleFileDrop(event)" ondragover="handleDragOver(event)" ondragleave="handleDragLeave(event)">
                    <input type="file" id="fileInput" class="hidden" accept=".csv,.xlsx,.xls,.json" multiple onchange="handleFileUpload(event)" />
                    <svg class="w-12 h-12 text-text-secondary mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                    </svg>
                    <p class="text-sm font-medium mb-1">Drop files here or click to browse</p>
                    <p class="text-xs text-text-secondary">CSV, Excel, JSON up to 100MB</p>
                </div>

                <!-- Upload Progress -->
                <div id="uploadProgress" class="hidden mt-4">
                    <div class="bg-primary-50 rounded-lg p-3">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-medium">Uploading...</span>
                            <span class="text-sm text-text-secondary" id="progressPercent">0%</span>
                        </div>
                        <div class="w-full bg-border-light rounded-full h-2">
                            <div class="bg-primary-600 h-2 rounded-full transition-all duration-300" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Uploaded Files List -->
            <div class="flex-1 overflow-y-auto">
                <div class="p-6">
                    <h3 class="text-sm font-semibold text-text-secondary mb-3">UPLOADED FILES</h3>
                    <div id="filesList" class="space-y-3">
                        <!-- Sample Files -->
                        <div class="file-item bg-primary-50 rounded-lg p-3 border border-primary-200">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-primary-600 rounded flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium">sales_data_2024.csv</p>
                                        <p class="text-xs text-text-secondary">1,247 rows â€¢ 8 columns â€¢ Active</p>
                                    </div>
                                </div>
                                <button class="text-text-secondary hover:text-error transition-colors" onclick="removeFile(this)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>

                        <div class="file-item bg-surface rounded-lg p-3 border border-border-light">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-secondary-600 rounded flex items-center justify-center">
                                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium">customer_survey.xlsx</p>
                                        <p class="text-xs text-text-secondary">892 rows â€¢ 12 columns</p>
                                    </div>
                                </div>
                                <button class="text-text-secondary hover:text-error transition-colors" onclick="removeFile(this)">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Chat Interface -->
        <div class="flex-1 flex flex-col bg-background">
            <!-- Chat Header -->
            <div class="bg-surface border-b border-border-light p-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-primary-600 to-secondary-500 rounded-full flex items-center justify-center">
                            <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                        </div>
                        <div>
                            <h3 class="font-semibold">danefordata AI Assistant</h3>
                            <p class="text-sm text-text-secondary">Ready to analyze your data</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-text-secondary hover:text-primary-600 transition-colors" onclick="clearChat()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                            </svg>
                        </button>
                        <button class="p-2 text-text-secondary hover:text-primary-600 transition-colors" onclick="toggleRightPanel()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h7"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Chat Messages Area -->
            <div class="flex-1 overflow-y-auto p-6" id="chatMessages">
                <!-- Welcome Message -->
                <div class="flex items-start space-x-3 mb-6 animate-fade-in">
                    <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                    </div>
                    <div class="bg-surface rounded-xl p-4 shadow-sm border border-border-light max-w-2xl">
                        <p class="text-text-primary mb-3">
                            ðŸ‘‹ Welcome to danefordata! I can see you have <strong>sales_data_2024.csv</strong> loaded. 
                            I'm ready to help you analyze your data through natural conversation.
                        </p>
                        <div class="bg-primary-50 rounded-lg p-3 mb-3">
                            <p class="text-sm font-medium text-primary-700 mb-2">Try asking me:</p>
                            <div class="space-y-1">
                                <button class="block text-left text-sm text-primary-600 hover:text-primary-700 transition-colors" onclick="askSuggestion('What are the top performing products?')">
                                    â€¢ "What are the top performing products?"
                                </button>
                                <button class="block text-left text-sm text-primary-600 hover:text-primary-700 transition-colors" onclick="askSuggestion('Show me sales trends over time')">
                                    â€¢ "Show me sales trends over time"
                                </button>
                                <button class="block text-left text-sm text-primary-600 hover:text-primary-700 transition-colors" onclick="askSuggestion('Which regions need attention?')">
                                    â€¢ "Which regions need attention?"
                                </button>
                            </div>
                        </div>
                        <p class="text-xs text-text-secondary">
                            ðŸ’¡ I can create charts, tables, and insights from your data. Just ask in plain English!
                        </p>
                    </div>
                </div>

                <!-- Sample Analysis Response -->
                <div class="flex items-start space-x-3 mb-6 justify-end animate-fade-in">
                    <div class="bg-primary-600 text-white rounded-xl p-4 max-w-md">
                        <p>Show me the top 5 products by revenue</p>
                    </div>
                    <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                </div>

                <div class="flex items-start space-x-3 mb-6 animate-fade-in">
                    <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                        </svg>
                    </div>
                    <div class="bg-surface rounded-xl p-4 shadow-sm border border-border-light max-w-4xl">
                        <p class="text-text-primary mb-4">
                            Great question! I've analyzed your sales data and here are the top 5 products by revenue:
                        </p>
                        
                        <!-- Interactive Chart Card -->
                        <div class="bg-gradient-to-br from-primary-50 to-secondary-50 rounded-lg p-4 mb-4 border border-primary-200">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-text-primary">Top 5 Products by Revenue</h4>
                                <div class="flex space-x-2">
                                    <button class="p-1 text-text-secondary hover:text-primary-600 transition-colors" onclick="expandChart(this)">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"/>
                                        </svg>
                                    </button>
                                    <button class="p-1 text-text-secondary hover:text-primary-600 transition-colors" onclick="exportChart(this)">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Chart Visualization -->
                            <div class="bg-surface rounded p-4 mb-3">
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-4 h-4 bg-primary-600 rounded"></div>
                                            <span class="text-sm font-medium">Premium Laptop Pro</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-32 bg-border-light rounded-full h-2">
                                                <div class="bg-primary-600 h-2 rounded-full" style="width: 100%"></div>
                                            </div>
                                            <span class="text-sm font-semibold">$2.4M</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-4 h-4 bg-secondary-500 rounded"></div>
                                            <span class="text-sm font-medium">Wireless Headphones X</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-32 bg-border-light rounded-full h-2">
                                                <div class="bg-secondary-500 h-2 rounded-full" style="width: 85%"></div>
                                            </div>
                                            <span class="text-sm font-semibold">$2.0M</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-4 h-4 bg-accent-500 rounded"></div>
                                            <span class="text-sm font-medium">Smart Watch Series 5</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-32 bg-border-light rounded-full h-2">
                                                <div class="bg-accent-500 h-2 rounded-full" style="width: 70%"></div>
                                            </div>
                                            <span class="text-sm font-semibold">$1.7M</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-4 h-4 bg-purple-500 rounded"></div>
                                            <span class="text-sm font-medium">Gaming Console Elite</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-32 bg-border-light rounded-full h-2">
                                                <div class="bg-purple-500 h-2 rounded-full" style="width: 60%"></div>
                                            </div>
                                            <span class="text-sm font-semibold">$1.4M</span>
                                        </div>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-4 h-4 bg-pink-500 rounded"></div>
                                            <span class="text-sm font-medium">Tablet Pro 12"</span>
                                        </div>
                                        <div class="flex items-center space-x-2">
                                            <div class="w-32 bg-border-light rounded-full h-2">
                                                <div class="bg-pink-500 h-2 rounded-full" style="width: 50%"></div>
                                            </div>
                                            <span class="text-sm font-semibold">$1.2M</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Key Insights -->
                            <div class="bg-accent-50 rounded p-3">
                                <p class="text-sm text-accent-700">
                                    <strong>ðŸ’¡ Key Insight:</strong> Premium Laptop Pro leads with $2.4M revenue, 
                                    representing 28% of total sales. The top 3 products account for 65% of revenue.
                                </p>
                            </div>
                        </div>

                        <p class="text-text-secondary text-sm">
                            Would you like me to analyze trends for these products or explore other aspects of your data?
                        </p>
                    </div>
                </div>
            </div>

            <!-- Chat Input Area -->
            <div class="bg-surface border-t border-border-light p-4">
                <!-- Smart Suggestions -->
                <div id="smartSuggestions" class="mb-3 hidden">
                    <div class="flex flex-wrap gap-2">
                        <button class="bg-primary-50 text-primary-600 px-3 py-1 rounded-full text-sm hover:bg-primary-100 transition-colors" onclick="askSuggestion('Show me trends over time')">
                            Show me trends over time
                        </button>
                        <button class="bg-secondary-50 text-secondary-600 px-3 py-1 rounded-full text-sm hover:bg-secondary-100 transition-colors" onclick="askSuggestion('Which segment performs best?')">
                            Which segment performs best?
                        </button>
                        <button class="bg-accent-50 text-accent-600 px-3 py-1 rounded-full text-sm hover:bg-accent-100 transition-colors" onclick="askSuggestion('Create a summary report')">
                            Create a summary report
                        </button>
                    </div>
                </div>

                <!-- Input Field -->
                <div class="flex space-x-3">
                    <div class="flex-1 relative">
                        <input type="text" placeholder="Ask a question about your data..." class="input-field pr-12" id="chatInput" onkeypress="handleEnterKey(event)" oninput="handleInputChange(event)" />
                        <button class="absolute right-3 top-1/2 transform -translate-y-1/2 text-text-secondary hover:text-primary-600 transition-colors" onclick="attachFile()">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                            </svg>
                        </button>
                    </div>
                    <button class="btn-primary px-6" onclick="sendMessage()" id="sendButton">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Sidebar - Insight Library -->
        <div class="w-80 bg-surface border-l border-border-light flex flex-col" id="rightSidebar">
            <!-- Sidebar Header -->
            <div class="p-6 border-b border-border-light">
                <h2 class="text-lg font-semibold mb-4">Insight Library</h2>
                
                <!-- Quick Actions -->
                <div class="grid grid-cols-2 gap-2">
                    <button class="bg-accent text-white px-4 py-2 rounded-lg font-semibold hover:bg-accent-600 transition-colors text-sm" onclick="saveTemplate()">
                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                        </svg>
                        Save Template
                    </button>
                    <button class="bg-surface text-primary-600 border border-primary-600 px-4 py-2 rounded-lg font-semibold hover:bg-primary-50 transition-colors text-sm" onclick="shareFindings()">
                        <svg class="w-4 h-4 mr-1 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.367 2.684 3 3 0 00-5.367-2.684z"/>
                        </svg>
                        Share
                    </button>
                </div>
            </div>

            <!-- Tabs -->
            <div class="border-b border-border-light">
                <div class="flex">
                    <button class="flex-1 py-3 px-4 text-sm font-medium text-primary-600 border-b-2 border-primary-600" id="savedTab" onclick="switchTab('saved')">
                        Saved Analyses
                    </button>
                    <button class="flex-1 py-3 px-4 text-sm font-medium text-text-secondary hover:text-primary-600 transition-colors" id="templatesTab" onclick="switchTab('templates')">
                        Templates
                    </button>
                </div>
            </div>

            <!-- Saved Analyses Content -->
            <div class="flex-1 overflow-y-auto" id="savedContent">
                <div class="p-6 space-y-4">
                    <!-- Saved Analysis Item -->
                    <div class="bg-primary-50 rounded-lg p-4 border border-primary-200">
                        <div class="flex items-start justify-between mb-2">
                            <h4 class="font-medium text-sm">Top Products Analysis</h4>
                            <button class="text-text-secondary hover:text-primary-600 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-text-secondary mb-3">Revenue analysis by product category</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-primary-600 bg-primary-100 px-2 py-1 rounded">Chart</span>
                            <span class="text-xs text-text-secondary">2 min ago</span>
                        </div>
                    </div>

                    <div class="bg-secondary-50 rounded-lg p-4 border border-secondary-200">
                        <div class="flex items-start justify-between mb-2">
                            <h4 class="font-medium text-sm">Regional Performance</h4>
                            <button class="text-text-secondary hover:text-secondary-600 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-text-secondary mb-3">Sales comparison across regions</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-secondary-600 bg-secondary-100 px-2 py-1 rounded">Table</span>
                            <span class="text-xs text-text-secondary">15 min ago</span>
                        </div>
                    </div>

                    <div class="bg-accent-50 rounded-lg p-4 border border-accent-200">
                        <div class="flex items-start justify-between mb-2">
                            <h4 class="font-medium text-sm">Trend Analysis</h4>
                            <button class="text-text-secondary hover:text-accent-600 transition-colors">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z"/>
                                </svg>
                            </button>
                        </div>
                        <p class="text-xs text-text-secondary mb-3">Monthly sales trends and forecasts</p>
                        <div class="flex items-center justify-between">
                            <span class="text-xs text-accent-600 bg-accent-100 px-2 py-1 rounded">Line Chart</span>
                            <span class="text-xs text-text-secondary">1 hour ago</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Templates Content (Hidden by default) -->
            <div class="flex-1 overflow-y-auto hidden" id="templatesContent">
                <div class="p-6 space-y-4">
                    <div class="bg-surface rounded-lg p-4 border border-border-light">
                        <h4 class="font-medium text-sm mb-2">Sales Dashboard</h4>
                        <p class="text-xs text-text-secondary mb-3">Complete sales performance overview</p>
                        <button class="w-full bg-primary-600 text-white py-2 rounded text-sm hover:bg-primary-700 transition-colors">
                            Use Template
                        </button>
                    </div>

                    <div class="bg-surface rounded-lg p-4 border border-border-light">
                        <h4 class="font-medium text-sm mb-2">Customer Analysis</h4>
                        <p class="text-xs text-text-secondary mb-3">Customer behavior and segmentation</p>
                        <button class="w-full bg-primary-600 text-white py-2 rounded text-sm hover:bg-primary-700 transition-colors">
                            Use Template
                        </button>
                    </div>

                    <div class="bg-surface rounded-lg p-4 border border-border-light">
                        <h4 class="font-medium text-sm mb-2">Financial Report</h4>
                        <p class="text-xs text-text-secondary mb-3">Revenue and profit analysis</p>
                        <button class="w-full bg-primary-600 text-white py-2 rounded text-sm hover:bg-primary-700 transition-colors">
                            Use Template
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Layout Adjustments -->
    <div class="md:hidden fixed bottom-4 right-4 z-50">
        <button class="bg-primary-600 text-white p-3 rounded-full shadow-lg" onclick="toggleMobilePanels()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
            </svg>
        </button>
    </div>

    <script>
        // Mobile menu toggle
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            menu.classList.toggle('hidden');
        }

        // File upload handlers
        function handleFileUpload(event) {
            const files = event.target.files;
            if (files.length > 0) {
                simulateFileUpload(files);
            }
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            const files = event.dataTransfer.files;
            if (files.length > 0) {
                simulateFileUpload(files);
            }
            event.target.classList.remove('border-primary-400', 'bg-primary-50');
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.target.classList.add('border-primary-400', 'bg-primary-50');
        }

        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            event.target.classList.remove('border-primary-400', 'bg-primary-50');
        }

        function simulateFileUpload(files) {
            const progressDiv = document.getElementById('uploadProgress');
            const progressBar = document.getElementById('progressBar');
            const progressPercent = document.getElementById('progressPercent');
            
            progressDiv.classList.remove('hidden');
            
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    setTimeout(() => {
                        progressDiv.classList.add('hidden');
                        addFileToList(files[0]);
                    }, 500);
                }
                progressBar.style.width = progress + '%';
                progressPercent.textContent = Math.round(progress) + '%';
            }, 200);
        }

        function addFileToList(file) {
            const filesList = document.getElementById('filesList');
            const fileItem = document.createElement('div');
            fileItem.className = 'file-item bg-surface rounded-lg p-3 border border-border-light';
            
            const fileType = file.name.split('.').pop().toLowerCase();
            const iconColor = fileType === 'csv' ? 'bg-primary-600' : fileType === 'xlsx' || fileType === 'xls' ? 'bg-secondary-600' : 'bg-accent-600';
            
            fileItem.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 ${iconColor} rounded flex items-center justify-center">
                            <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm font-medium">${file.name}</p>
                            <p class="text-xs text-text-secondary">Processing...</p>
                        </div>
                    </div>
                    <button class="text-text-secondary hover:text-error transition-colors" onclick="removeFile(this)">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                </div>
            `;
            
            filesList.appendChild(fileItem);
            
            // Simulate processing completion
            setTimeout(() => {
                const statusElement = fileItem.querySelector('.text-xs.text-text-secondary');
                statusElement.textContent = `${Math.floor(Math.random() * 1000) + 100} rows â€¢ ${Math.floor(Math.random() * 10) + 3} columns`;
            }, 2000);
        }

        function removeFile(button) {
            button.closest('.file-item').remove();
        }

        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            // Simulate AI response
            setTimeout(() => {
                addAIResponse(message);
            }, 1000);
        }

        function addUserMessage(message) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3 mb-6 justify-end animate-fade-in';
            messageDiv.innerHTML = `
                <div class="bg-primary-600 text-white rounded-xl p-4 max-w-md">
                    <p>${message}</p>
                </div>
                <div class="w-10 h-10 bg-gray-300 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function addAIResponse(userMessage) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3 mb-6 animate-fade-in';
            
            const responses = [
                "I'd be happy to help analyze that! Based on your data, here are the key insights...",
                "Great question! Let me create a visualization to show you the trends...",
                "I've analyzed your data and found some interesting patterns. Here's what I discovered...",
                "That's an excellent analytical question. Let me break down the data for you..."
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            messageDiv.innerHTML = `
                <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                    </svg>
                </div>
                <div class="bg-surface rounded-xl p-4 shadow-sm border border-border-light max-w-2xl">
                    <p class="text-text-primary">${randomResponse}</p>
                </div>
            `;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function askSuggestion(suggestion) {
            document.getElementById('chatInput').value = suggestion;
            sendMessage();
        }

        function handleEnterKey(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }

        function handleInputChange(event) {
            const suggestions = document.getElementById('smartSuggestions');
            if (event.target.value.length > 0) {
                suggestions.classList.remove('hidden');
            } else {
                suggestions.classList.add('hidden');
            }
        }

        // Panel management
        function toggleRightPanel() {
            const rightSidebar = document.getElementById('rightSidebar');
            rightSidebar.classList.toggle('hidden');
        }

        function switchTab(tab) {
            const savedTab = document.getElementById('savedTab');
            const templatesTab = document.getElementById('templatesTab');
            const savedContent = document.getElementById('savedContent');
            const templatesContent = document.getElementById('templatesContent');
            
            if (tab === 'saved') {
                savedTab.className = 'flex-1 py-3 px-4 text-sm font-medium text-primary-600 border-b-2 border-primary-600';
                templatesTab.className = 'flex-1 py-3 px-4 text-sm font-medium text-text-secondary hover:text-primary-600 transition-colors';
                savedContent.classList.remove('hidden');
                templatesContent.classList.add('hidden');
            } else {
                templatesTab.className = 'flex-1 py-3 px-4 text-sm font-medium text-primary-600 border-b-2 border-primary-600';
                savedTab.className = 'flex-1 py-3 px-4 text-sm font-medium text-text-secondary hover:text-primary-600 transition-colors';
                templatesContent.classList.remove('hidden');
                savedContent.classList.add('hidden');
            }
        }

        // Utility functions
        function startNewAnalysis() {
            document.getElementById('chatInput').focus();
        }

        function exportResults() {
            alert('Export functionality would be implemented here');
        }

        function clearChat() {
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = `
                <div class="flex items-start space-x-3 mb-6 animate-fade-in">
                    <div class="w-10 h-10 bg-primary-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                        </svg>
                    </div>
                    <div class="bg-surface rounded-xl p-4 shadow-sm border border-border-light max-w-2xl">
                        <p class="text-text-primary">Chat cleared! Ready for a new analysis. What would you like to explore?</p>
                    </div>
                </div>
            `;
        }

        function expandChart(button) {
            alert('Chart expansion functionality would be implemented here');
        }

        function exportChart(button) {
            alert('Chart export functionality would be implemented here');
        }

        function attachFile() {
            document.getElementById('fileInput').click();
        }

        function saveTemplate() {
            alert('Template saving functionality would be implemented here');
        }

        function shareFindings() {
            alert('Share functionality would be implemented here');
        }

        function toggleMobilePanels() {
            const leftSidebar = document.getElementById('leftSidebar');
            const rightSidebar = document.getElementById('rightSidebar');
            
            // Toggle visibility for mobile
            leftSidebar.classList.toggle('hidden');
            rightSidebar.classList.toggle('hidden');
        }

        // Responsive adjustments
        function handleResize() {
            const leftSidebar = document.getElementById('leftSidebar');
            const rightSidebar = document.getElementById('rightSidebar');
            
            if (window.innerWidth < 768) {
                leftSidebar.classList.add('absolute', 'z-40', 'h-full');
                rightSidebar.classList.add('absolute', 'z-40', 'h-full', 'right-0');
            } else {
                leftSidebar.classList.remove('absolute', 'z-40', 'h-full', 'hidden');
                rightSidebar.classList.remove('absolute', 'z-40', 'h-full', 'right-0', 'hidden');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            handleResize();
            window.addEventListener('resize', handleResize);
        });
    </script>

    <style>
        @media (max-width: 768px) {
            #leftSidebar, #rightSidebar {
                position: absolute;
                z-index: 40;
                height: 100%;
            }
            
            #rightSidebar {
                right: 0;
            }
            
            #leftSidebar.hidden, #rightSidebar.hidden {
                transform: translateX(-100%);
            }
            
            #rightSidebar.hidden {
                transform: translateX(100%);
            }
        }
        
        .file-item {
            transition: all 0.2s ease;
        }
        
        .file-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
    </style>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>